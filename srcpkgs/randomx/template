# Template file for 'randomx'
pkgname=randomx
version=1.1.8
revision=1
wrksrc="RandomX-${version}"
build_style=cmake
short_desc="Proof of work algorithm based on random code execution"
maintainer="Kevin Crumb <kevcrumb@splitlinux.org>"
license="BSD-3-Clause"
homepage="https://github.com/tevador/randomx"
distfiles="https://github.com/tevador/RandomX/archive/v${version}.tar.gz"
checksum="f982a12d18b1d260bef2a1d3c46ae4902975fbf63abb38ca6413c96d1778db3a"

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	makedepends+=" libatomic-devel"
	configure_args+=" -DCMAKE_CXX_STANDARD_LIBRARIES=-latomic"
fi

case "$XBPS_TARGET_MACHINE" in
	armv7*) configure_args+=" -DARCH=armv7" ;;
	armv6*) configure_args+=" -DARCH=armv6" ;;
	armv5*) configure_args+=" -DARCH=armv5" ;;
	aarch64*) configure_args+=" -DARCH=aarch64" ;;
	i686*) configure_args+=" -DARCH=i686" ;;
	mips*) configure_args+=" -DARCH=mipsr32 -DNO_AES=ON" ;;
	ppc64le*) configure_args+=" -DARCH=ppc64le" ;;
	ppc64*) configure_args+=" -DARCH=ppc64" ;;
	ppc*) configure_args+=" -DARCH=ppc" ;;
	x86_64*) configure_args+=" -DARCH=x86_64" ;;
	*) broken="unsupported architecture" ;;
esac


post_install() {
	vlicense LICENSE
}
