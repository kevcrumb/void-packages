# Template file for 'csminer'
pkgname=csminer
version=0.2.0
revision=1
short_desc="Easy-to-use CPU miner for Monero"
maintainer="Kevin Crumb <kevcrumb@splitlinux.org>"
license="GPL-3.0-or-later"
homepage="https://cryptonote.social"
#distfiles="https://cryptonote.social/static/csminer/csminer-${version}-linux.tgz"
#checksum=f0ce530d82bae0dba8b488d885dc6fdfbb8219bd24e9298986db2ca9291b6c21
#build_style=go
#go_import_path="github.com/cryptonote-social/csminer"
hostmakedepends="git go"
makedepends="librandomx librandomx-go-git"
#go_get=yes
#create_wrksrc=yes


do_fetch() {
	git clone https://github.com/cryptonote-social/csminer csminer-${version}
	cd csminer-${version} && git checkout 4eafaa9b65155747c856c57e5a4ed216212499d4
}

do_patch() {
	cd rx && patch -i ${FILESDIR}/correct-paths.patch && cd ..
}

do_build() {
	go get github.com/cryptonote-social/csminer/blockchain
	go get github.com/cryptonote-social/csminer/crylog
	go get github.com/cryptonote-social/csminer/stratum/client
	go get github.com/godbus/dbus

	mkdir -p /tmp/go/src/github.com/cryptonote-social/csminer/rx/../../rxlib/
	cp /usr/lib/rxlib.cpp.o /tmp/go/src/github.com/cryptonote-social/csminer/rx/../../rxlib/
	go get github.com/cryptonote-social/csminer/minerlib

	cd linux && go build -a -buildmode=pie csminer.go
}

do_install() {
	vinstall linux/csminer 755 usr/bin
}
